<template>
  <div class="user_moment">
    <div class="user_moment_title" style="margin-bottom: 7px">
      <div class="QQ_home_head head" :style="`background-image:url('${head}')`"></div>
      <div style="width: 100%; display: grid; grid-template-rows: 1fr 1fr; row-gap: 4px">
        <div style="display: flex; align-items: center">
          <span style="color: black !important"
            ><strong class="moment_sender">{{ props.post.sender }}</strong></span
          >
          <svg viewBox="0 0 1024 1024" width="18" height="18" style="margin-left: auto">
            <path
              d="M512.4 429.1c22.3 0 41.7 7.9 58.1 23.6 7.9 7.9 13.9 16.9 18.2 27.1 4.3 10.2 6.4 20.8 6.4 32 0 22.3-8.2 41.7-24.6 58.1-3.3 3.3-6.6 6.1-9.9 8.4s-6.9 4.4-10.8 6.4c-3.9 2-8 3.6-12.3 4.9-4.3 1.3-8.5 2.5-12.8 3.4-4.2 1-8.3 1.5-12.3 1.5-23 0-42.5-8.2-58.6-24.6s-24.1-35.9-24.1-58.6c0-22.6 7.9-42.2 23.6-58.6 5.3-4.6 11-8.9 17.2-12.8 6.2-3.9 13-6.7 20.2-8.4 7.2-1.6 14.4-2.4 21.7-2.4z m326.8 0c23 0 42.3 7.9 58.1 23.6 5.3 5.3 9.7 11 13.3 17.2 3.6 6.2 6.4 13 8.4 20.2 2 7.2 3 14.4 3 21.7 0 22.3-8.2 41.7-24.6 58.1-3.3 3.9-7.2 7.4-11.8 10.3-4.6 2.9-9.4 5.4-14.3 7.4s-10.2 3.6-15.8 4.9-11 2-16.3 2c-23 0-42.5-8.2-58.6-24.6-16.1-16.4-24.1-35.9-24.1-58.6 0-22.6 8.2-42.2 24.6-58.6 7.2-7.2 16.1-13 26.6-17.2 10.5-4.2 21-6.3 31.5-6.4z m-654.6 0c23 0 42.3 7.9 58.1 23.6 5.3 5.3 9.7 11 13.3 17.2 3.6 6.2 6.4 13 8.4 20.2s3 14.4 3 21.7c0 22.3-8 41.7-24.1 58.1s-35.6 24.6-58.6 24.6-42.3-8.2-58.1-24.6c-7.9-7.9-13.9-16.9-18.2-27.1-4.3-10.2-6.4-20.5-6.4-31 0-23 8.2-42.7 24.6-59.1 7.2-7.2 16.1-13 26.6-17.2 10.4-4.2 20.9-6.3 31.4-6.4z"
              p-id="14923"
              fill="#000000"
            ></path>
          </svg>
        </div>
        <span style="color: #626367; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-size: 12px">{{
          props.post.time
        }}</span>
      </div>
    </div>
    <span
      style="color: black !important; font-size: 15px; line-height: 1.3"
      class="moment_message"
      v-html="spaceContent"
    ></span>
    <template v-for="img of props.post.imgs">
      <div v-if="img.imgtype == 'img'" class="space_fakeimg">{{ img.content }}</div>
      <div v-if="img.imgtype == 'emoji'" class="space_emoji" :style="`background-Image:url('${img.url}')`"></div
    ></template>
    <div style="display: flex; align-items: center; gap: 3px; margin-top: 5px">
      <svg
        t="1736250731870"
        class="icon"
        viewBox="0 0 1024 1024"
        version="1.1"
        xmlns="http://www.w3.org/2000/svg"
        p-id="16069"
        width="16"
        height="16"
      >
        <path
          d="M512 416a96 96 0 1 1-96 96 96 96 0 0 1 96-96m0-64a160 160 0 1 0 160 160 160 160 0 0 0-160-160z"
          fill="#a1a1a1"
          p-id="16070"
        ></path>
        <path
          d="M512 298.88c188.64 0 288 113.92 366.72 213.12C800 611.36 700.64 725.12 512 725.12S224 611.36 145.28 512C224 412.64 323.36 298.88 512 298.88m0-64C264.64 234.88 147.52 406.56 64 512c83.52 105.44 200.64 277.12 448 277.12S876.48 617.44 960 512c-83.52-105.44-200.64-277.12-448-277.12z"
          fill="#a1a1a1"
          p-id="16071"
        ></path>
      </svg>
      <span style="color: #a1a1a1; font-size: 13px">浏览{{ props.post.see }}次</span>
      <div class="moment_button">
        <svg viewBox="0 0 1024 1024" width="26" height="26">
          <path
            d="M190.193225 471.411583c14.446014 0 26.139334-11.718903 26.139334-26.13831 0-14.44499-11.69332-26.164916-26.139334-26.164916-0.271176 0-0.490164 0.149403-0.73678 0.149403l-62.496379 0.146333c-1.425466-0.195451-2.90005-0.295735-4.373611-0.295735-19.677155 0-35.621289 16.141632-35.621289 36.114522L86.622358 888.550075c0 19.949354 15.96767 35.597753 35.670407 35.597753 1.916653 0 3.808746 0.292666 5.649674 0l61.022819 0.022513c0.099261 0 0.148379 0.048095 0.24764 0.048095 0.097214 0 0.146333-0.048095 0.24457-0.048095l0.73678 0 0-0.148379c13.413498-0.540306 24.174586-11.422144 24.174586-24.960485 0-13.55983-10.760065-24.441669-24.174586-24.981974l0-0.393973-50.949392 0 1.450025-402.275993L190.193225 471.409536z"
            fill="#000000"
            p-id="19734"
          ></path>
          <path
            d="M926.52241 433.948343c-19.283182-31.445176-47.339168-44.172035-81.289398-45.546336-1.77032-0.246617-3.536546-0.39295-5.380544-0.39295l-205.447139-0.688685c13.462616-39.059598 22.698978-85.58933 22.698978-129.317251 0-28.349675-3.193739-55.962569-9.041934-82.542948l-0.490164 0.049119c-10.638291-46.578852-51.736315-81.31498-100.966553-81.31498-57.264215 0-95.466282 48.15065-95.466282 106.126063 0 3.241834-0.294712 6.387477 0 9.532097-2.996241 108.386546-91.240027 195.548698-196.23636 207.513194l0 54.881958-0.785899 222.227314 0 229.744521 10.709923 0 500.025271 0.222057 8.746198-0.243547c19.35686 0.049119 30.239721-4.817726 47.803749-16.116049 16.682961-10.761088 29.236881-25.50079 37.490869-42.156122 2.260483-3.341095 4.028757-7.075139 5.106298-11.20111l77.018118-344.324116c1.056052-4.053316 1.348718-8.181333 1.056052-12.160971C943.643346 476.446249 938.781618 453.944769 926.52241 433.948343zM893.82573 486.837924l-82.983993 367.783411-0.099261-0.049119c-2.555196 6.141884-6.879688 11.596106-12.872169 15.427364-4.177136 2.727111-8.773827 4.351098-13.414521 4.964058-1.49812-0.195451-3.046383 0-4.620227 0l-477.028511-0.540306-0.171915-407.408897c89.323375-40.266076 154.841577-79.670527 188.596356-173.661202 0.072655 0.024559 0.124843 0.049119 0.195451 0.072655 2.99931-9.137101 6.313799-20.73423 8.697079-33.164331 5.551436-29.185716 5.258771-58.123792 5.258771-58.123792-4.937452-37.98001 25.940812-52.965306 44.364417-52.965306 25.304316 0.860601 50.263777 33.656541 50.263777 52.326762 0 0 5.600555 27.563776 5.649674 57.190537 0.048095 37.366026-4.6673 56.847729-4.6673 56.847729l-0.466628 0c-5.872754 30.879288-16.214287 60.138682-30.464849 86.964654l0.36839 0.342808c-2.358721 4.815679-3.709485 10.220782-3.709485 15.943111 0 19.922748 19.088754 21.742187 38.765909 21.742187l238.761895 0.270153c0 0 14.666024 0.465604 14.690584 0.465604l0 0.100284c12.132318-0.638543 24.221658 5.207605 31.100322 16.409738 5.504364 9.016351 6.437619 19.6045 3.486404 28.988218L893.82573 486.837924z"
            fill="#000000"
            p-id="19735"
          ></path>
          <path
            d="M264.827039 924.31872c0.319272 0.024559 0.441045 0.024559 0.295735-0.024559 0.243547-0.048095 0.367367-0.074701-0.295735-0.074701s-0.539282 0.026606-0.271176 0.074701C264.43409 924.343279 264.532327 924.343279 264.827039 924.31872z"
            fill="#000000"
            p-id="19736"
          ></path>
        </svg>
        <svg viewBox="0 0 1024 1024" width="28" height="28">
          <path
            d="M185.2 888.7c-16.6 0-30-13.4-30-30v-580c0-49.6 40.4-90 90-90h540c49.6 0 90 40.4 90 90v410c0 49.6-40.4 90-90 90h-429c-16.6 0-30-13.4-30-30s13.4-30 30-30h429c16.5 0 30-13.5 30-30v-410c0-16.5-13.5-30-30-30h-540c-16.5 0-30 13.5-30 30v580c0 16.5-13.5 30-30 30z m490.1-430.5H347c-16.6 0-30-13.4-30-30s13.4-30 30-30h328.3c16.6 0 30 13.4 30 30s-13.4 30-30 30zM494 598.2H345.7c-16.6 0-30-13.4-30-30s13.4-30 30-30H494c16.6 0 30 13.4 30 30s-13.4 30-30 30zM194.2 883.7c-9.8 0-19.3-4.8-25.1-13.5-9.1-13.9-5.2-32.5 8.6-41.5l160-105c13.9-9.1 32.5-5.2 41.5 8.6 9.1 13.9 5.2 32.5-8.6 41.5l-160 105c-5 3.3-10.8 4.9-16.4 4.9z"
            fill="#202020"
            p-id="31300"
          ></path>
        </svg>
        <svg viewBox="0 0 1024 1024" width="28" height="28">
          <path
            d="M168.021333 751.104a53.333333 53.333333 0 0 1-81.450666-55.893333c48-219.733333 177.493333-333.184 381.205333-332.458667l8.490667-0.213333V186.026667c0-8.213333 2.602667-16.213333 7.445333-22.826667 1.237333-1.621333 1.237333-1.621333 2.602667-3.136a33.92 33.92 0 0 1 47.936-1.621333l370.197333 346.005333a32 32 0 0 0 1.066667 0.938667c7.914667 6.784 12.437333 16.576 12.437333 26.901333v3.498667c0 10.325333-4.522667 20.117333-12.373333 26.837333l-0.896 0.768-0.256 0.213333-370.922667 323.968c-1.109333 0.938667-1.109333 0.938667-2.282667 1.834667-15.146667 11.093333-36.437333 7.786667-47.509333-7.36a38.656 38.656 0 0 1-7.466667-22.826667v-197.248l-7.253333-0.362666c-112.213333 1.237333-212.266667 31.04-300.970667 89.472z m301.290667-153.472l1.962667 0.021333 68.992 3.541334v195.52l301.44-263.274667-301.44-281.749333v173.12l-31.146667 0.853333-40.597333 1.066667c-165.504-0.554667-268.117333 82.773333-313.386667 256.896 93.76-56.192 198.698667-84.906667 314.176-85.994667z m384.64-65.322667v3.498667c0-0.597333 0-1.173333 0.042667-1.749333a28.714667 28.714667 0 0 1-0.042667-1.749334z"
            fill="#000000"
            p-id="33532"
          ></path>
        </svg>
      </div>
    </div>
    <div style="display: flex; align-items: center; gap: 3px; margin-top: 0">
      <svg
        t="1736250924867"
        class="icon"
        viewBox="0 0 1024 1024"
        version="1.1"
        xmlns="http://www.w3.org/2000/svg"
        p-id="17414"
        width="16"
        height="16"
      >
        <path
          d="M736.653061 929.959184H287.346939c-45.97551 0-83.591837-37.616327-83.591837-83.591837V177.632653c0-45.97551 37.616327-83.591837 83.591837-83.591837h449.306122c45.97551 0 83.591837 37.616327 83.591837 83.591837v668.734694c0 45.97551-37.616327 83.591837-83.591837 83.591837zM287.346939 135.836735c-22.987755 0-41.795918 18.808163-41.795919 41.795918v668.734694c0 22.987755 18.808163 41.795918 41.795919 41.795918h449.306122c22.987755 0 41.795918-18.808163 41.795919-41.795918V177.632653c0-22.987755-18.808163-41.795918-41.795919-41.795918H287.346939z"
          fill="#a1a1a1"
          p-id="17415"
        ></path>
        <path
          d="M616.489796 815.020408H407.510204c-11.493878 0-20.897959-9.404082-20.897959-20.897959s9.404082-20.897959 20.897959-20.897959h208.979592c11.493878 0 20.897959 9.404082 20.897959 20.897959s-9.404082 20.897959-20.897959 20.897959z"
          fill="#a1a1a1"
          p-id="17416"
        ></path>
      </svg>
      <span style="color: #a1a1a1; font-size: 13px">{{ phone }}</span>
    </div>
    <div style="display: flex; align-items: center; gap: 3px; margin-top: 5px; margin-bottom: 5px">
      <svg class="icon" viewBox="0 0 1024 1024" width="13" height="13">
        <path
          d="M773.6 912.7h-1.2c-37.2-0.4-74.5-0.4-111.8-0.4h-56.9c-38 0-76 0-114.1-0.5-21.1-0.6-41.9-5-61.5-13-33.3-13-52.3-42-52.2-79.7l0.1-141.4c0-78.3 0-156.7 0.7-235 0.1-21.3 13.8-41.3 25.5-51.8 45.3-41.4 94.5-93 115.1-162.6 5.7-19.4 7.9-40.8 10.2-63.4 4.6-45 33.8-74.3 72.8-74.3 15.3 0 30.6 4.6 45.6 13.5 30.1 18.1 50.2 46.5 61.3 87 17.8 64.3 8.7 126.7-1.3 180.2v0.2c-2.3 12.5 7.1 24.1 19.9 24.1h130c22.4 0 54.5 2.8 74.3 26.8 14.4 17.5 18.5 41.1 12.4 72.3-18.6 95.9-41.4 192.6-63.2 282.7-6.8 28.1-18.1 54.1-29 79.3l-4.7 10.8c-12.4 29.2-38 45.2-72 45.2zM216.1 903.3h-11.9c-43 0-78.2-35.2-78.2-78.2V476.6c0-43 35.2-78.2 78.2-78.2h11.9c43 0 78.2 35.2 78.2 78.2V825c0.1 43.1-35.1 78.3-78.2 78.3z"
          fill="#000000"
          p-id="34839"
        ></path>
      </svg>
      <span style="color: #474545; font-size: 14px">{{ props.post.like }}人已赞</span>
    </div>
    <div class="user_leave_message_list">
      <div v-for="value in props.post.comment" class="user_leave_message">
        <span style="color: black !important"
          ><strong>{{ value.sender }}</strong
          >：{{ value.content }}</span
        >
      </div>
    </div>
    <div style="display: flex; align-items: center; gap: 3px; margin-top: 10px">
      <div class="user_avatar" style="width: 30px; min-width: 30px; height: 30px; border-radius: 50%"></div>
      <div
        style="
          display: flex;
          align-items: center;
          width: 100%;
          background-color: #f5f5f5;
          padding-right: 5px;
          margin-left: 5px;
        "
      >
        <input
          v-model="comment"
          type="text"
          placeholder="说点什么吧..."
          style="
            height: 30px;
            width: 100%;
            margin-left: 5px !important;
            border-radius: 4px !important;
            background-color: #f5f5f5 !important;
            padding: 6px;
            border: none !important;
          "
        />
        <svg @click="sendComment" viewBox="0 0 1024 1024" width="20" height="20" class="moment_comment">
          <path
            d="M871.04 89.770667L120.064 380.16a51.2 51.2 0 0 0-1.792 94.762667l303.36 130.56 131.072 303.957333a51.2 51.2 0 0 0 94.805333-1.877333l289.792-751.573334a51.2 51.2 0 0 0-66.261333-66.133333z m-41.130667 107.392l-231.978666 601.642666-97.962667-227.114666-3.584-7.338667a85.333333 85.333333 0 0 0-41.045333-37.248l-226.56-97.536 601.173333-232.405333z"
            fill="#a1a1a1"
            p-id="18561"
          ></path>
        </svg>
      </div>
    </div>
    <div
      style="
        width: 110%;
        height: 8px;
        background-color: #e9e9e9;
        margin-left: -7px;
        margin-top: 10px;
        margin-bottom: 10px;
      "
    ></div>
  </div>
</template>

<script setup>
import { defineProps, computed, watch, ref } from 'vue';
import { addQQNpc, sharedState } from '../shared-state';
const props = defineProps(['post']);
console.log(`创建新动态内容:${JSON.stringify(props)}  ${props.post.id}`);

addQQNpc(props.post.sender);
const head = computed(() => {
  const sender = props.post.sender;
  if (sender in sharedState.QQ.chars) {
    if (sharedState.QQ.chars[sender].head) {
      return sharedState.QQ.chars[sender].head;
    } else {
      return '';
    }
  } else {
    return '';
  }
});

const phone = computed(() => {
  // return;
  const sender = props.post.sender;
  if (sender in sharedState.QQ.chars == false) {
    return '隐藏机型';
  }
  if ('phone' in sharedState.QQ.chars[sender] == false) {
    return '隐藏机型';
  }

  return sharedState.QQ.chars[sender].phone;
});
const spaceContent = computed(() => {
  // return;
  return props.post.content.replace(/\\n/g, '<br>');
});

const comment = ref('');

function sendComment() {
  if (!comment.value || sharedState.generate) {
    return;
  }

  let message = sharedState.QQ.cacheMsg.join('\n').trim();
  message += `\n在${props.post.sender}发的帖子${props.post.id}中评论:${comment.value}`;

  if (sharedState.phone.sendModel == '尾附') {
    const old_content = $('#send_textarea').val().trim();
    const new_content = old_content + message;
    $('#send_textarea')
      .val(new_content.trim() || '')[0]
      .dispatchEvent(new Event('input', { bubbles: true }));
    comment.value = '';
    sharedState.QQ.cacheMsg = [];
    return;
  }

  triggerSlash(`/send ${message.trim()}|/trigger`);

  comment.value = '';
  sharedState.QQ.cacheMsg = [];
}
</script>

<style>
.space_emoji {
  width: 100%;
  aspect-ratio: 1;
  background-size: cover;
  background-repeat: no-repeat;
  border: 1px solid rgb(215, 213, 213);
  margin-top: 5px;
  border-radius: 5px;
}
</style>
