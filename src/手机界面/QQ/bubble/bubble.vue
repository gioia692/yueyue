<template>
  <div
    v-if="props.bubble.msgtype != 'system'"
    :class="props.bubble.sender == 'user' ? 'QQ_chat_mymsg' : 'QQ_chat_charmsg'"
  >
    <div
      v-if="props.bubble.sender != 'user'"
      :data-name="props.bubble.sender"
      class="QQ_chat_head head"
      :style="{
        backgroundImage: `url(${props.senderinfo?.head})`,
      }"
    ></div>
    <div
      :style="`width: ${props.bubble.msgtype == 'transfer' && props.bubble.sender == 'user' ? '100%' : 'auto'}; height: auto; margin-top: 4px; `"
    >
      <span
        v-if="props.isGroup == 'Group' && props.bubble.sender != 'user' && props.bubble.sender != 'user'"
        style="overflow: hidden; text-overflow: ellipsis; display: block; max-width: 100%"
        >{{ sharedState.QQ.chars[props.bubble.sender]?.name || props.bubble.sender }}</span
      >
      <!-- 这里是消息内容 -->
      <!-- text类型 -->
      <div
        v-if="props.bubble.msgtype == 'text'"
        :class="`QQ_chat_msgdiv ${props.isGroup == 'Group' && props.bubble.sender != 'user' ? 'groupmsg' : ''}`"
        :data-name="props.bubble.sender"
      >
        <span>{{ props.bubble.content }}</span>
      </div>
      <!-- img类型 -->
      <div
        v-if="props.bubble.msgtype == 'img'"
        :class="`QQ_chat_msgdiv ${props.isGroup == 'Group' && props.bubble.sender != 'user' ? 'groupmsg' : ''}`"
        :data-name="props.bubble.sender"
      >
        <div
          class="QQ_chat_fakeimg"
          :style="`text-align: center;${props.bubble.additionalText ? 'margin-bottom:5px;' : ''}`"
        >
          <div v-html="warpHandle(props.bubble.content)"></div>
        </div>
        {{ props.bubble.additionalText }}
      </div>
      <!-- emoji类型 -->
      <div
        v-if="props.bubble.msgtype == 'emoji'"
        :class="`QQ_chat_msgdiv ${props.isGroup == 'Group' && props.bubble.sender != 'user' ? 'groupmsg' : ''}`"
        :data-name="props.bubble.sender"
      >
        <div style="width: 100%; background-color: white; aspect-ratio: 1">
          <img
            class="msgimg"
            loading="lazy"
            :src="props.bubble.emoji"
            :alt="props.bubble.emoji ? '图片加载失败,可能是网络问题' : 'Ai编了个不存在的表情包'"
          />
        </div>
        <span v-if="props.bubble.additionalText" style="margin-top: 5px; display: block">
          {{ props.bubble.additionalText }}
        </span>
      </div>
      <!-- music类型 -->
      <div
        v-if="props.bubble.msgtype == 'music'"
        :class="`QQ_chat_music ${props.isGroup == 'Group' && props.bubble.sender != 'user' ? 'groupmsg' : ''}`"
      >
        <div class="music-container" style="display: grid; grid-template-columns: 1fr 64px; width: 100%">
          <div style="display: flex; flex-direction: column; margin-top: 8px; overflow: hidden; max-width: 100%">
            <div class="hide-title music-name" style="font-size: 1.2rem">
              <strong>{{ props.bubble.song }}</strong>
            </div>
            <div
              class="hide-title music-author"
              style="color: #8d8c8d; margin-left: 3px; margin-top: 10px; font-size: 1rem"
            >
              {{ props.bubble.singer }}
            </div>
          </div>
          <div style="margin-left: auto; position: relative; height: 64px; width: 64px">
            <div class="icon-container" style="width: 64px; width: 64px; position: relative">
              <svg
                style="position: absolute; left: -3px; top: -5px"
                class="icon"
                viewBox="0 0 1024 1024"
                width="72"
                height="72"
              >
                <path
                  d="M773.9392 301.8752m-200.0384 0a200.0384 200.0384 0 1 0 400.0768 0 200.0384 200.0384 0 1 0-400.0768 0Z"
                  fill="#d81e06"
                  p-id="51386"
                ></path>
                <path
                  d="M924.4672 706.2528a24.32 24.32 0 0 1-24.2688 24.2688h-145.7664a24.3712 24.3712 0 0 0-24.2688 24.32 24.2688 24.2688 0 0 0 24.2688 24.2688h48.5888a24.32 24.32 0 0 1 24.2688 24.32 24.32 24.32 0 0 1-24.2688 24.2688h-64.512A388.7616 388.7616 0 0 1 122.88 390.4512h-48.5888a24.32 24.32 0 0 1 0-48.5888h97.28a24.2688 24.2688 0 0 0 6.8096-47.5648l0.768-0.9728H122.88a24.32 24.32 0 1 1 0-48.5888h101.632a388.7616 388.7616 0 0 1 619.52 437.248h56.32a24.32 24.32 0 0 1 24.1152 24.2688z"
                  fill="#2c2c2c"
                  p-id="51387"
                ></path>
                <path
                  d="M565.8112 478.8736a3.84 3.84 0 0 0-4.5568 4.608c3.1744 14.7456 7.8848 40.96 9.984 60.0576 3.6352 32.2048-28.5696 62.3104-53.6064 70.7584-39.424 13.568-84.8896-18.688-95.1296-56.32-11.776-43.9808 12.6464-97.5872 53.2992-115.0464 4.5056-2.0992 9.0112-3.8912 13.568-5.9904 9.3184-4.2496 4.8128-11.1616 3.2768-17.5104-4.1984-17.4592-6.6048-34.9184 2.4064-51.2 13.568-24.4224 48.7936-43.6736 76.1856-31.9488a276.48 276.48 0 0 1 34.6624 16.5888 25.1904 25.1904 0 0 1 10.5472 28.2624c-5.7344 15.36-20.7872 18.9952-36.7616 9.6768a196.1984 196.1984 0 0 0-17.4592-9.9328 16.2304 16.2304 0 0 0-23.808 15.36 150.3744 150.3744 0 0 0 1.9456 18.0224 18.4832 18.4832 0 0 0 13.568 14.8992 200.3456 200.3456 0 0 1 29.3888 8.9088c38.8096 17.152 66.56 45.1584 79.5136 87.04 24.064 77.6704-21.0944 155.0848-87.9616 184.6272a182.016 182.016 0 0 1-116.8384 13.2096 185.6 185.6 0 0 1-126.464-104.8064c-18.0736-40.96-22.8864-82.7904-8.7552-127.0784 18.9952-59.2384 56.9344-99.6352 114.7392-121.9072a23.4496 23.4496 0 0 1 28.0064 9.728 21.1456 21.1456 0 0 1-6.0416 29.5424 259.8912 259.8912 0 0 1-25.2928 13.568c-31.8976 16.2304-51.7632 42.752-64.4096 75.8784-24.7296 64.4096 9.3184 139.1104 65.6384 168.3456 51.7632 27.0848 122.5728 16.2304 160.8192-28.3136A106.2912 106.2912 0 0 0 619.52 542.72c-5.12-25.6-34.5088-59.2896-53.7088-63.8464z m-53.4016 5.9904a6.144 6.144 0 0 0-7.9872-4.5056c-33.28 11.4688-47.5136 47.2576-31.9488 76.4416a28.0064 28.0064 0 0 0 30.1056 13.824c14.1824-4.1984 24.1152-14.4384 22.016-27.6992-2.9696-19.5072-7.936-38.8096-12.1856-58.0608z"
                  fill="#d81e06"
                  p-id="51388"
                ></path>
              </svg>
              <div
                class="music-img"
                style="
                  width: 64px;
                  height: 64px;
                  position: absolute;
                  left: 0;
                  top: 0;
                  background-size: cover;
                  z-index: 1;
                  background-image: url('https://y.qq.com/music/photo_new/T002R800x800M000004Z85XP1c25b7.jpg');
                  display: none;
                "
              ></div>
            </div>

            <div class="music-play-button">
              <svg class="icon-music-play" viewBox="0 0 1024 1024" width="24" height="24">
                <path
                  d="M902.420317 544.833016l-585.142857-357.587302v715.174603l585.142857-357.587301z"
                  p-id="42990"
                  fill="#ffffff"
                ></path>
              </svg>
              <svg
                class="icon-music-stop"
                t="1743245033745"
                viewBox="0 0 1024 1024"
                width="19"
                height="19"
                style="display: none"
              >
                <path
                  d="M290.133333 128h-39.808C206.336 128 170.666667 178.944 170.666667 241.792v540.416C170.666667 845.056 206.336 896 250.325333 896H290.133333c43.946667 0 79.658667-50.944 79.658667-113.792V241.792C369.792 178.944 334.08 128 290.133333 128zM773.674667 128H733.866667c-43.989333 0-79.658667 50.944-79.658667 113.792v540.416c0 62.848 35.669333 113.792 79.658667 113.792h39.808C817.664 896 853.333333 845.056 853.333333 782.208V241.792C853.333333 178.944 817.664 128 773.674667 128z"
                  fill="#ffffff"
                  p-id="43402"
                ></path>
              </svg>
            </div>
          </div>
        </div>
        <div style="width: 100%; height: 2px; background-color: #efefef; margin-bottom: 5px; margin-top: 5px"></div>
        <div style="display: flex; align-items: center; gap: 5px">
          <svg viewBox="0 0 1024 1024" style="width: 0.9rem; height: 0.9rem">
            <path
              d="M0 0m184.32 0l655.36 0q184.32 0 184.32 184.32l0 655.36q0 184.32-184.32 184.32l-655.36 0q-184.32 0-184.32-184.32l0-655.36q0-184.32 184.32-184.32Z"
              fill="#EA3E3C"
              p-id="1500"
            ></path>
            <path
              d="M527.616 849.43872a373.6064 373.6064 0 0 1-162.54976-39.00416c-112.36352-55.16288-180.00896-176.29184-172.55424-308.67456 7.41376-130.34496 85.10464-237.4656 202.752-279.552a35.85024 35.85024 0 0 1 24.15616 67.51232c-107.66336 38.49216-150.81472 136.86784-155.29984 216.13568-5.86752 103.51616 46.08 197.79584 132.34176 240.13824 124.69248 60.30336 216.91392 22.35392 260.82304-5.64224 59.8016-38.16448 97.86368-100.01408 96.95232-157.55264-1.024-63.72352-24.064-120.99584-63.27296-157.14304a145.408 145.408 0 0 0-65.5872-35.28704q2.82624 9.76896 5.64224 19.32288c13.38368 45.63968 24.94464 85.05344 25.6 114.40128a134.26688 134.26688 0 0 1-37.69344 97.76128 139.1104 139.1104 0 0 1-100.6592 40.45824 140.10368 140.10368 0 0 1-100.47488-42.24 169.12384 169.12384 0 0 1-46.2848-122.76736c1.19808-85.12512 80.11776-153.28256 162.816-175.104a324.80256 324.80256 0 0 1-6.71744-67.05152 92.0576 92.0576 0 0 1 69.18144-91.81184c46.21312-12.53376 104.448 5.19168 124.66176 37.888a35.84 35.84 0 0 1-11.70432 49.31584 35.84 35.84 0 0 1-49.26464-11.65312 62.34112 62.34112 0 0 0-48.45568-5.21216c-4.32128 1.71008-12.35968 4.90496-12.76928 23.10144a270.87872 270.87872 0 0 0 6.73792 58.51136 217.4976 217.4976 0 0 1 133.56032 57.6512c53.57568 49.38752 85.0432 125.46048 86.35392 208.71168 1.29024 81.85856-49.7664 167.86432-130.048 219.136a310.14912 310.14912 0 0 1-168.2432 48.65024z m23.6544-457.55392c-56.77056 15.6672-107.4688 63.03744-108.07296 106.42432a98.304 98.304 0 0 0 25.6512 71.43424 68.0448 68.0448 0 0 0 49.36704 20.87936 67.24608 67.24608 0 0 0 49.44896-18.944 63.19104 63.19104 0 0 0 17.23392-46.08c-0.4096-19.79392-11.7248-58.368-22.67136-95.6928-3.61472-12.42112-7.35232-25.14944-10.9568-38.02112z"
              fill="#FFFFFF"
              p-id="1501"
            ></path>
          </svg>
          <div style="font-size: 0.9rem; color: #8d8c8c">网易云音乐</div>
        </div>
      </div>
      <!-- voice类型 -->
      <div
        v-if="props.bubble.msgtype == 'voice'"
        :class="`QQ_chat_msgdiv ${props.isGroup == 'Group' && props.bubble.sender != 'user' ? 'groupmsg' : ''}`"
        :data-name="props.bubble.sender"
      >
        <div
          v-if="props.bubble.sender == 'user'"
          class="QQ_chat_voice"
          @click="voice2text"
          style="width: 100%; display: flex; gap: 5px; align-items: center"
        >
          <span style="display: block" class="totext">
            <svg
              style="margin-right: 30px; display: flex; align-items: center"
              viewBox="0 0 1024 1024"
              width="24"
              height="24"
            >
              <path
                d="M999.611733 387.697778a37.831111 37.831111 0 0 0-48.355555 22.641778v0.512l-1.592889 5.233777c-58.88-241.208889-302.648889-388.892444-543.857778-330.012444A446.805333 446.805333 0 0 0 124.546844 295.253333a39.139556 39.139556 0 0 0 13.653334 53.077334 39.310222 39.310222 0 0 0 18.944 5.233777c13.084444 0 25.201778-6.826667 32.540444-18.375111a374.158222 374.158222 0 0 1 359.480889-183.978666 381.952 381.952 0 0 1 337.351111 334.279111 384.568889 384.568889 0 0 1-3.128889 115.086222v2.616889a38.855111 38.855111 0 0 0 21.560889 48.355555c19.456 6.826667 41.528889-3.185778 48.355556-22.641777l68.835555-192.284445a39.310222 39.310222 0 0 0-22.584889-48.924444z m-148.764444 348.956444a38.115556 38.115556 0 0 0-31.004445 16.839111 373.077333 373.077333 0 0 1-355.214222 157.639111 381.212444 381.212444 0 0 1-323.185778-306.346666 396.344889 396.344889 0 0 1 0-140.856889v-1.592889a39.139556 39.139556 0 0 0-22.072888-48.355556 38.058667 38.058667 0 0 0-48.355556 22.584889l-68.835556 191.317334a38.513778 38.513778 0 0 0 23.608889 48.867555c19.456 7.395556 40.96-3.128889 48.355556-22.584889v-3.697777c58.88 241.208889 302.705778 388.892444 543.914667 330.012444A448.739556 448.739556 0 0 0 881.851733 798.151111a38.684444 38.684444 0 0 0-8.362666-54.158222 31.857778 31.857778 0 0 0-22.641778-7.338667z"
                p-id="41017"
                fill="currentColor"
              ></path>
              <path
                d="M310.687289 693.020444a50.517333 50.517333 0 0 0-33.166222 19.456 40.96 40.96 0 0 0 0 31.573334c1.592889 4.721778 3.697778 9.443556 6.257777 14.165333a26.794667 26.794667 0 0 0 13.198223 11.036445 30.833778 30.833778 0 0 0 12.060444 2.104888h5.290667c6.826667-1.080889 13.653333-2.616889 20.48-4.721777 15.758222-5.290667 32.028444-11.605333 48.924444-18.432 16.782222-6.826667 34.133333-15.758222 49.322667-23.608889 15.246222-7.907556 32.597333-17.863111 46.250667-26.282667 14.222222-8.419556 24.177778-15.758222 35.271111-24.177778 24.632889 19.456 50.915556 36.238222 78.791111 49.891556 33.621333 17.351111 68.835556 31.004444 105.073778 42.097778a56.32 56.32 0 0 0 20.48 3.640889 33.905778 33.905778 0 0 0 34.190222-26.282667 39.025778 39.025778 0 0 0-1.592889-35.726222 49.322667 49.322667 0 0 0-26.225778-18.375111 540.842667 540.842667 0 0 1-85.162667-33.621334 603.932444 603.932444 0 0 1-63.601777-38.912c20.48-23.096889 37.831111-48.355556 52.565333-75.662222a465.294222 465.294222 0 0 0 38.343111-98.304h49.436445a38.456889 38.456889 0 0 0 26.282666-12.060444 46.762667 46.762667 0 0 0 7.850667-26.282667 44.032 44.032 0 0 0-8.931556-28.899556 37.432889 37.432889 0 0 0-26.282666-11.036444H568.6784a116.167111 116.167111 0 0 0-9.500444-17.863111c-10.467556-12.629333-22.584889-25.770667-34.702223-38.912a47.786667 47.786667 0 0 0-27.818666-18.375111h-4.209778a36.636444 36.636444 0 0 0-24.177778 8.419555 35.896889 35.896889 0 0 0-18.375111 29.923556 51.2 51.2 0 0 0 16.270222 33.109333l6.314667 6.314667H315.352178a34.133333 34.133333 0 0 0-26.282667 12.629333 45.852444 45.852444 0 0 0-6.826667 26.282667c-0.512 10.467556 2.104889 20.48 7.907556 28.899555 6.826667 6.826667 16.270222 11.036444 26.282667 11.036445h47.274666c5.233778 15.758222 10.524444 32.028444 16.839111 47.786666a419.271111 419.271111 0 0 0 50.403556 94.094223c8.419556 11.036444 17.351111 22.584889 26.282667 33.109333a389.461333 389.461333 0 0 1-64.625778 39.936c-26.282667 12.629333-54.101333 23.096889-81.976889 32.028444z m131.299555-246.954666h140.344889c-6.826667 23.096889-16.839111 45.169778-28.387555 66.730666a325.290667 325.290667 0 0 1-39.936 55.751112 319.146667 319.146667 0 0 1-39.424-52.622223l-2.616889-4.209777a388.778667 388.778667 0 0 1-29.980445-65.649778z"
                p-id="41018"
                fill="currentColor"
              ></path>
            </svg>
          </span>
          <div style="display: flex; align-items: center; gap: 5px; margin-left: auto">
            <span style="display: block">
              <svg
                style="transform: rotate(-90deg); display: flex; align-items: center"
                t="1742985508017"
                class="icon"
                viewBox="0 0 1024 1024"
                version="1.1"
                xmlns="http://www.w3.org/2000/svg"
                p-id="38914"
                width="20"
                height="20"
              >
                <path
                  d="M99.931429 457.782857c8.137143 8.137143 20.132571 7.716571 27.849142-0.420571 101.156571-107.574857 234.861714-164.150857 384.438858-164.150857 150.418286 0 284.562286 56.996571 385.28 164.571428 7.277714 7.296 18.870857 7.296 26.569142-0.859428l57.014858-56.996572c6.838857-7.277714 6.838857-16.713143 1.28-23.570286-96.859429-119.149714-279.003429-206.994286-470.144-206.994285S138.934857 257.206857 42.057143 376.356571c-5.997714 6.857143-5.577143 16.274286 1.28 23.588572z m171.428571 171.867429c8.576 8.996571 19.712 8.137143 27.849143-1.28 49.718857-55.296 130.285714-95.158857 213.010286-94.299429 83.565714-0.859429 163.712 40.283429 213.851428 95.579429 8.137143 8.557714 18.852571 8.557714 27.008-0.438857l63.853714-62.994286c6.857143-6.857143 7.716571-15.853714 1.28-23.149714-62.134857-76.708571-177.426286-133.284571-305.993142-133.284572-128.585143 0-243.858286 56.996571-306.011429 133.302857-6.418286 7.277714-5.558857 15.835429 1.28 23.131429z m240.859429 224.987428c8.996571 0 17.133714-4.717714 32.987428-20.132571l100.297143-96.438857c6.418286-5.997714 7.716571-15.414857 2.139429-22.710857-27.008-34.706286-77.568-64.713143-135.424-64.713143-59.154286 0-110.573714 31.286857-137.142858 67.291428-3.858286 5.997714-2.56 14.134857 3.84 20.132572l100.297143 96.438857c15.853714 15.414857 24.009143 20.132571 33.005715 20.132571z"
                  p-id="38915"
                  fill="currentColor"
                ></path>
              </svg>
            </span>
            <span>{{ props.bubble?.voicetime }}"</span>
          </div>
        </div>
        <div
          v-if="props.bubble.sender != 'user'"
          class="QQ_chat_voice"
          @click="voice2text"
          style="width: 100%; display: flex; gap: 5px; align-items: center"
        >
          <span style="margin-left: 2px">{{ props.bubble?.voicetime }}"</span>
          <span style="display: block">
            <svg
              style="transform: rotate(90deg); display: flex; align-items: center"
              class="icon"
              viewBox="0 0 1024 1024"
              width="20"
              height="20"
            >
              <path
                d="M99.931429 457.782857c8.137143 8.137143 20.132571 7.716571 27.849142-0.420571 101.156571-107.574857 234.861714-164.150857 384.438858-164.150857 150.418286 0 284.562286 56.996571 385.28 164.571428 7.277714 7.296 18.870857 7.296 26.569142-0.859428l57.014858-56.996572c6.838857-7.277714 6.838857-16.713143 1.28-23.570286-96.859429-119.149714-279.003429-206.994286-470.144-206.994285S138.934857 257.206857 42.057143 376.356571c-5.997714 6.857143-5.577143 16.274286 1.28 23.588572z m171.428571 171.867429c8.576 8.996571 19.712 8.137143 27.849143-1.28 49.718857-55.296 130.285714-95.158857 213.010286-94.299429 83.565714-0.859429 163.712 40.283429 213.851428 95.579429 8.137143 8.557714 18.852571 8.557714 27.008-0.438857l63.853714-62.994286c6.857143-6.857143 7.716571-15.853714 1.28-23.149714-62.134857-76.708571-177.426286-133.284571-305.993142-133.284572-128.585143 0-243.858286 56.996571-306.011429 133.302857-6.418286 7.277714-5.558857 15.835429 1.28 23.131429z m240.859429 224.987428c8.996571 0 17.133714-4.717714 32.987428-20.132571l100.297143-96.438857c6.418286-5.997714 7.716571-15.414857 2.139429-22.710857-27.008-34.706286-77.568-64.713143-135.424-64.713143-59.154286 0-110.573714 31.286857-137.142858 67.291428-3.858286 5.997714-2.56 14.134857 3.84 20.132572l100.297143 96.438857c15.853714 15.414857 24.009143 20.132571 33.005715 20.132571z"
                p-id="38915"
                fill="currentColor"
              ></path>
            </svg>
          </span>

          <span style="display: block; margin-left: auto" class="totext">
            <svg
              style="margin-left: 30px; display: flex; align-items: center"
              viewBox="0 0 1024 1024"
              width="24"
              height="24"
            >
              <path
                d="M999.611733 387.697778a37.831111 37.831111 0 0 0-48.355555 22.641778v0.512l-1.592889 5.233777c-58.88-241.208889-302.648889-388.892444-543.857778-330.012444A446.805333 446.805333 0 0 0 124.546844 295.253333a39.139556 39.139556 0 0 0 13.653334 53.077334 39.310222 39.310222 0 0 0 18.944 5.233777c13.084444 0 25.201778-6.826667 32.540444-18.375111a374.158222 374.158222 0 0 1 359.480889-183.978666 381.952 381.952 0 0 1 337.351111 334.279111 384.568889 384.568889 0 0 1-3.128889 115.086222v2.616889a38.855111 38.855111 0 0 0 21.560889 48.355555c19.456 6.826667 41.528889-3.185778 48.355556-22.641777l68.835555-192.284445a39.310222 39.310222 0 0 0-22.584889-48.924444z m-148.764444 348.956444a38.115556 38.115556 0 0 0-31.004445 16.839111 373.077333 373.077333 0 0 1-355.214222 157.639111 381.212444 381.212444 0 0 1-323.185778-306.346666 396.344889 396.344889 0 0 1 0-140.856889v-1.592889a39.139556 39.139556 0 0 0-22.072888-48.355556 38.058667 38.058667 0 0 0-48.355556 22.584889l-68.835556 191.317334a38.513778 38.513778 0 0 0 23.608889 48.867555c19.456 7.395556 40.96-3.128889 48.355556-22.584889v-3.697777c58.88 241.208889 302.705778 388.892444 543.914667 330.012444A448.739556 448.739556 0 0 0 881.851733 798.151111a38.684444 38.684444 0 0 0-8.362666-54.158222 31.857778 31.857778 0 0 0-22.641778-7.338667z"
                p-id="41017"
                fill="currentColor"
              ></path>
              <path
                d="M310.687289 693.020444a50.517333 50.517333 0 0 0-33.166222 19.456 40.96 40.96 0 0 0 0 31.573334c1.592889 4.721778 3.697778 9.443556 6.257777 14.165333a26.794667 26.794667 0 0 0 13.198223 11.036445 30.833778 30.833778 0 0 0 12.060444 2.104888h5.290667c6.826667-1.080889 13.653333-2.616889 20.48-4.721777 15.758222-5.290667 32.028444-11.605333 48.924444-18.432 16.782222-6.826667 34.133333-15.758222 49.322667-23.608889 15.246222-7.907556 32.597333-17.863111 46.250667-26.282667 14.222222-8.419556 24.177778-15.758222 35.271111-24.177778 24.632889 19.456 50.915556 36.238222 78.791111 49.891556 33.621333 17.351111 68.835556 31.004444 105.073778 42.097778a56.32 56.32 0 0 0 20.48 3.640889 33.905778 33.905778 0 0 0 34.190222-26.282667 39.025778 39.025778 0 0 0-1.592889-35.726222 49.322667 49.322667 0 0 0-26.225778-18.375111 540.842667 540.842667 0 0 1-85.162667-33.621334 603.932444 603.932444 0 0 1-63.601777-38.912c20.48-23.096889 37.831111-48.355556 52.565333-75.662222a465.294222 465.294222 0 0 0 38.343111-98.304h49.436445a38.456889 38.456889 0 0 0 26.282666-12.060444 46.762667 46.762667 0 0 0 7.850667-26.282667 44.032 44.032 0 0 0-8.931556-28.899556 37.432889 37.432889 0 0 0-26.282666-11.036444H568.6784a116.167111 116.167111 0 0 0-9.500444-17.863111c-10.467556-12.629333-22.584889-25.770667-34.702223-38.912a47.786667 47.786667 0 0 0-27.818666-18.375111h-4.209778a36.636444 36.636444 0 0 0-24.177778 8.419555 35.896889 35.896889 0 0 0-18.375111 29.923556 51.2 51.2 0 0 0 16.270222 33.109333l6.314667 6.314667H315.352178a34.133333 34.133333 0 0 0-26.282667 12.629333 45.852444 45.852444 0 0 0-6.826667 26.282667c-0.512 10.467556 2.104889 20.48 7.907556 28.899555 6.826667 6.826667 16.270222 11.036444 26.282667 11.036445h47.274666c5.233778 15.758222 10.524444 32.028444 16.839111 47.786666a419.271111 419.271111 0 0 0 50.403556 94.094223c8.419556 11.036444 17.351111 22.584889 26.282667 33.109333a389.461333 389.461333 0 0 1-64.625778 39.936c-26.282667 12.629333-54.101333 23.096889-81.976889 32.028444z m131.299555-246.954666h140.344889c-6.826667 23.096889-16.839111 45.169778-28.387555 66.730666a325.290667 325.290667 0 0 1-39.936 55.751112 319.146667 319.146667 0 0 1-39.424-52.622223l-2.616889-4.209777a388.778667 388.778667 0 0 1-29.980445-65.649778z"
                p-id="41018"
                fill="currentColor"
              ></path>
            </svg>
          </span>
        </div>
        <div class="voice2text" v-show="totext">
          <div style="width: 100%; height: 1px; background-color: black; margin-top: 10px; margin-bottom: 8px"></div>
          <span>{{ props.bubble?.content }}</span>
        </div>
      </div>
      <!-- transfer类型 -->
      <div v-if="props.bubble.msgtype == 'transfer' && props.bubble.sender != 'user'" class="give_money">
        <div
          style="
            background-color: #4396f7;
            height: 80px;
            width: 100%;
            color: #ffffff;
            padding-top: 20px;
            padding-left: 12px;
            display: flex;
            flex-direction: column;
            gap: 5px;
            position: relative;
          "
        >
          <span>{{ props.bubble?.count }}</span>
          <span>已转入你的余额</span>
          <div
            style="
              border-radius: 50%;
              background-color: #9fccf1;
              width: 50px;
              height: 50px;
              position: absolute;
              right: 10px;
              display: flex;
              align-items: center;
              justify-content: center;
              top: 15px;
            "
          >
            <svg
              t="1738258225266"
              class="icon"
              viewBox="0 0 1024 1024"
              version="1.1"
              xmlns="http://www.w3.org/2000/svg"
              p-id="4449"
              width="33"
              height="33"
            >
              <path
                d="M954.014 510.695c-31.51 0.303-185.995-88.917-190.874-93.568-11.734-11.188-7.3-25.115 4.673-27.02s79.203-9.898 79.203-9.898c-41.318-110.437-133.518-198.636-254.527-227.223-193.138-45.643-392.87 83.827-437.013 281.424-0.38 1.685-3.047 21.83-19.045 21.191-10.83-0.432-46.309-14.539-59.136-20.556-14.644-6.868-18.601-5.094-14.16-27.201C113.37 156.643 370.632-12.653 617.554 45.272c204.919 48.063 347.27 225.878 362.91 428.477 2.619 27.151-11.203 36.797-26.451 36.944z m-322.516 55.059c20.284 0 36.729 16.427 36.729 36.727 0 20.265-16.445 36.729-36.729 36.729h-73.456v45.909c0 25.359-20.551 45.911-45.911 45.911-25.358 0-45.91-20.551-45.91-45.911V639.21h-73.456c-20.284 0-36.727-16.465-36.727-36.729 0-20.302 16.444-36.727 36.727-36.727h73.456v-36.73h-73.456c-20.284 0-36.727-16.461-36.727-36.726 0-20.3 16.444-36.729 36.727-36.729h73.456v-2.512l-81.508-81.491c-14.445-14.455-14.445-37.875 0-52.313s37.858-14.437 52.304 0l74.497 74.478 74.786-74.784c14.444-14.419 37.859-14.419 52.303 0 14.446 14.454 14.446 37.877 0 52.313l-80.558 80.559v3.749h73.456c20.284 0 36.729 16.429 36.729 36.729 0 20.267-16.445 36.726-36.729 36.726h-73.456v36.73h73.456z m-368.471 51.828c16.112 10.302 12.229 30.994-5.477 32.836s-73.153 6.725-73.153 6.725C228.353 760.157 317.44 841.379 432.63 868.585c193.137 45.623 390.651-77.582 434.806-275.179 0.906-4.054 0.877-3.418 2.457-12.122s4.139-21.945 21.142-16.052 58.475 18.085 71.394 21.539 11.465 8.548 9.846 20.553c-0.493 3.651-1.238 6.994-2.017 10.509-57.81 256.921-309.451 417.196-562.049 357.924-204.677-48.01-346.947-225.429-362.865-427.724-2.159-34.762 22.4-41.857 47.505-28.577 19.75 10.447 154.064 87.822 170.176 98.124z"
                p-id="4450"
                fill="#4090ee"
              ></path>
            </svg>
          </div>
        </div>
        <div
          style="
            background-color: #ffffff;
            width: 100%;
            height: 30px;
            color: #959598;
            font-size: 13px;
            padding-left: 10px;
            padding-top: 8px;
          "
        >
          QQ转账
        </div>
      </div>
      <div v-if="props.bubble.msgtype == 'transfer' && props.bubble.sender == 'user'" class="give_money">
        <div
          style="
            background-color: #4396f7;
            height: 80px;
            width: 100%;
            color: #ffffff;
            padding-top: 20px;
            padding-left: 12px;
            padding-right: 12px;
            display: flex;
            gap: 5px;
            position: relative;
          "
        >
          <div
            style="
              border-radius: 50%;
              background-color: #9fccf1;
              width: 50px;
              min-width: 50px;
              min-height: 50px;
              height: 50px;
              right: 10px;
              display: flex;
              align-items: center;
              justify-content: center;
              top: 15px;
            "
          >
            <svg
              t="1738258225266"
              class="icon"
              viewBox="0 0 1024 1024"
              version="1.1"
              xmlns="http://www.w3.org/2000/svg"
              p-id="4449"
              width="33"
              height="33"
            >
              <path
                d="M954.014 510.695c-31.51 0.303-185.995-88.917-190.874-93.568-11.734-11.188-7.3-25.115 4.673-27.02s79.203-9.898 79.203-9.898c-41.318-110.437-133.518-198.636-254.527-227.223-193.138-45.643-392.87 83.827-437.013 281.424-0.38 1.685-3.047 21.83-19.045 21.191-10.83-0.432-46.309-14.539-59.136-20.556-14.644-6.868-18.601-5.094-14.16-27.201C113.37 156.643 370.632-12.653 617.554 45.272c204.919 48.063 347.27 225.878 362.91 428.477 2.619 27.151-11.203 36.797-26.451 36.944z m-322.516 55.059c20.284 0 36.729 16.427 36.729 36.727 0 20.265-16.445 36.729-36.729 36.729h-73.456v45.909c0 25.359-20.551 45.911-45.911 45.911-25.358 0-45.91-20.551-45.91-45.911V639.21h-73.456c-20.284 0-36.727-16.465-36.727-36.729 0-20.302 16.444-36.727 36.727-36.727h73.456v-36.73h-73.456c-20.284 0-36.727-16.461-36.727-36.726 0-20.3 16.444-36.729 36.727-36.729h73.456v-2.512l-81.508-81.491c-14.445-14.455-14.445-37.875 0-52.313s37.858-14.437 52.304 0l74.497 74.478 74.786-74.784c14.444-14.419 37.859-14.419 52.303 0 14.446 14.454 14.446 37.877 0 52.313l-80.558 80.559v3.749h73.456c20.284 0 36.729 16.429 36.729 36.729 0 20.267-16.445 36.726-36.729 36.726h-73.456v36.73h73.456z m-368.471 51.828c16.112 10.302 12.229 30.994-5.477 32.836s-73.153 6.725-73.153 6.725C228.353 760.157 317.44 841.379 432.63 868.585c193.137 45.623 390.651-77.582 434.806-275.179 0.906-4.054 0.877-3.418 2.457-12.122s4.139-21.945 21.142-16.052 58.475 18.085 71.394 21.539 11.465 8.548 9.846 20.553c-0.493 3.651-1.238 6.994-2.017 10.509-57.81 256.921-309.451 417.196-562.049 357.924-204.677-48.01-346.947-225.429-362.865-427.724-2.159-34.762 22.4-41.857 47.505-28.577 19.75 10.447 154.064 87.822 170.176 98.124z"
                p-id="4450"
                fill="#4090ee"
              ></path>
            </svg>
          </div>
          <div style="display: flex; flex-direction: column; gap: 5px; margin-left: 5px">
            <span style="text-align: start">{{ props.bubble?.count }}</span>
            <span style="text-align: start">已转入好友余额</span>
          </div>
        </div>
        <div
          style="
            background-color: #ffffff;
            width: 100%;
            height: 30px;
            color: #959598;
            font-size: 13px;
            padding-left: 10px;
            padding-top: 8px;
            text-align: start;
          "
        >
          QQ转账
        </div>
      </div>
    </div>
    <div
      v-if="props.bubble.sender == 'user'"
      class="user_avatar Chat_MyHead"
      :style="{
        backgroundImage: `url(${sharedState.ST.userHead})`,
      }"
    ></div>
  </div>

  <!-- system类型 -->
  <div
    v-if="props.bubble.msgtype == 'system'"
    style="color: #959597; font-size: 12px; text-align: center; margin-bottom: 20px"
  >
    {{ props.bubble?.content }}
  </div>
</template>

<script setup>
import { defineProps, computed } from 'vue';
import { sharedState, addQQNpc } from '../../shared-state';

const props = defineProps({
  bubble: {
    type: Object,
  },
  isGroup: {
    type: String,
  },
  senderinfo: {
    type: Object,
  },
});

if ('sender' in props.bubble == false) {
  console.log(`这条消息没有sender:\n${JSON.stringify(props.bubble)}`);
}

if (props.bubble?.sender && props.bubble?.sender != 'user' && props.bubble?.sender in sharedState.QQ.chars == false) {
  // 随机出现的路人
  addQQNpc(props.bubble?.sender);
}

const bubbleColor = computed(() => {
  if (props.bubble.sender == 'user') {
    return sharedState.QQ.default.bubble;
  }
  const color = props.senderinfo?.bubble || sharedState.QQ.default.bubble;
  return color;
});

const textColor = computed(() => {
  if (props.bubble.sender == 'user') {
    return sharedState.QQ.default.text;
  }
  const color = props.senderinfo?.text || sharedState.QQ.default.text;
  return color;
});

let totext = ref(false);
function voice2text() {
  totext.value = !totext.value;
}

function warpHandle(content) {
  console.log(`warp:${content}`);
  return content.replace(/\n/g, '<br>');
}

function emojiHandle() {}
</script>

<style>
.groupmsg {
  margin-top: 6px;
}

.QQ_chat_msgdiv {
  background-color: v-bind(bubbleColor);
  span {
    color: v-bind(textColor);
  }
}
</style>
